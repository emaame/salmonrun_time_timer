(()=>{var e={399(e){var t;t=function(e,t,n){var o;if(XMLHttpRequest)o=new XMLHttpRequest;else if(ActiveXObject)try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(!o)return t.call(this,"Giving up :( Cannot create an XMLHTTP instance",null),!1;o.onreadystatechange=function(){if(4===o.readyState)if(o.status>=200&&o.status<400){var e=o.responseText;if(!(n&&n.hasOwnProperty("raw")&&n.raw))try{e=JSON.parse(e)}catch(e){return void t.call(this,e,null)}t.call(this,null,e)}else t.call(this,new Error("There was a problem with the request"),null)};var i=n&&n.method?n.method:"GET";if("GET"==i){var r=[];if(n&&n.params&&"object"==typeof n.params)for(var s in n.params)r.push(s+"="+encodeURIComponent(n.params[s]));e=r.length>0?e+"?"+r.join("&"):e,o.open("GET",e),o.send()}else if("POST"==i){var a=n&&n.data?n.data:n.params?n.params:{};o.open("POST",e),o.send(JSON.stringify(a))}return o},e.exports&&(e.exports=t),"undefined"!=typeof window&&(window.getJSONData=t)}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var i=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time_offset=t},n=[{key:"listup_next_STT",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=[];e=this.time_offset?this.time_offset.get_time(t):new Date(t);for(var r=Math.floor((e.getUTCMinutes()-n)/o)+1,s=e.getUTCHours(),a=1;i.length<7&&a<4;++a){for(var u=r+1;u<=7&&i.length<7;++u){var l=n+(u-1)*o,f=l+o;if(f>=60&&f%60>=n)break;var c=new Date(e);c.setUTCHours(s),c.setUTCMinutes(l),c.setUTCSeconds(0),c.setUTCMilliseconds(0),i.push(c)}r=0,s+=1}return i}}],n&&t(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();const r=i;function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,u(o.key),o)}}function u(e){var t=function(e){if("object"!=s(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}const l=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"getMonthTextInLocalTime",value:function(e){var t=e.getMonth()+1,n=e.getDate();t<10&&(t="0"+t),n<10&&(n="0"+n);var o=e.getHours(),i=e.getMinutes(),r=e.getSeconds();return o<10&&(o="0"+o),i<10&&(i="0"+i),r<10&&(r="0"+r),t+"/"+n+" "+o+":"+i+":"+r}},{key:"getRestTimeTextInUTC",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.getUTCMinutes(),o=e.getUTCSeconds(),i=e.getUTCMilliseconds();return t?(n<10&&(n="0"+n),o<10&&(o="0"+o),i<10?i="00"+i:i<100&&(i="0"+i),n+":"+o+"."+i):(i>0&&(o+=1)>=60&&(o-=60,n+=1),n<10&&(n="0"+n),o<10&&(o="0"+o),n+":"+o)}}],t&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,d(o.key),o)}}function d(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}n(399);var h="mode_friend",m="mode_frequency_update",y="mode_show_ms",v="use_sound",p="timeoffset",b="timeoffset_updatedAt",_={};_[h]={type:Boolean,default:!1},_[m]={type:Boolean,default:!1},_[y]={type:Boolean,default:!1},_[v]={type:Boolean,default:!1},_[p]={type:Number,default:0},_[b]={type:Number,default:0};var g=new(function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scheme=t},(t=[{key:"load",value:function(){var e=this;this.scheme,Object.keys(this.scheme).forEach(function(t){var n=e.scheme[t],o=n.type,i=localStorage[t];null==i&&(i=n.default),o===Boolean?e[t]="true"==i||1==i:e[t]=o===Number?Number(i):o===String?String(i):i},this)}},{key:"save",value:function(e,t){localStorage[e]=t,this[e]=t}}])&&c(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}())(_);g.load();const w=g;function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,L(o.key),o)}}function E(e,t,n){return t&&k(e.prototype,t),n&&k(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function L(e){var t=function(e){if("object"!=S(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:t+""}var j=function(){return E(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;T(this,e),this.offset_jst=0,this.set_offset_friend(t),this.get_offset_jst()},[{key:"get_time",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=0;return this.offset_jst&&(t+=this.offset_jst),this.offset_friend&&(t+=this.offset_friend),new Date(e+t)}},{key:"set_offset_friend",value:function(e){this.offset_friend=e}},{key:"use_cached_data",value:function(){this.offset_jst=w[p]}},{key:"get_offset_jst",value:function(){var e=this;(new x).get_offset().then(function(t){t?e.set_offset_jst(t):e.use_cached_data()}).catch(function(t){e.use_cached_data()})}},{key:"set_offset_jst",value:function(e){this.offset_jst=e,w.save(p,this.offset_jst),w.save(b,Date.now())}}])}(),x=function(){return E(function e(){T(this,e)},[{key:"parse",value:function(e){var t=e.match(/S(\d+\.\d+),VS\d+,VE\d+/);if(!t||t.length<2)return null;var n=parseFloat(t[1]);return n-Math.floor(n)>=.5?n-1:n}},{key:"get_offset",value:function(){var e=this;try{var t=location.href+"?"+Math.random().toString(),n=Date.now();return fetch(t,{method:"HEAD",cache:"no-cache",referrerPolicy:"no-referrer"}).then(function(t){var o=Date.now();return 1e3*e.parse(t.headers.get("x-timer"))-.5*(n+o)}).catch(function(e){return null})}catch(e){return null}}}])}();const M=j;function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function A(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,P(o.key),o)}}function P(e){var t=function(e){if("object"!=C(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==C(t)?t:t+""}const U=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.soundURLs=["1.wav","2.wav","3.wav","4.wav","5.wav","10.wav","30.wav","quite-impressed.mp3"].map(function(e){return"./sounds/"+e}),this.sources=new Array(this.soundURLs.length),this.buffers=new Array(this.soundURLs.length),this.playing=new Array(this.soundURLs.length,!1),this.audioContext=window.AudioContext||window.webkitAudioContext,this.noAudioContext=!1,this.fallbackAudio,void 0!==this.audioContext?this.audioCtx=new this.audioContext:(this.noAudioContext=!0,this.fallbackAudio=document.createElement("audio"))},(t=[{key:"loadAll",value:function(){var e=this;return Promise.all(this.soundURLs.map(function(t,n,o){return e._load(n).then(function(t){t&&(e.buffers[n]=t)})}))}},{key:"playSilent",value:function(){this.audioCtx.resume();var e=this.audioCtx.createBuffer(1,1,22050),t=this.audioCtx.createBufferSource();t.buffer=e,t.connect(this.audioCtx.destination),t.start(0)}},{key:"play",value:function(e){var t=this;return this._load(e).then(function(n){if(t.noAudioContext)return t.fallbackAudio.currentTime=0,void t.fallbackAudio.play();t.audioCtx.resume();var o=t.audioCtx.createBufferSource();o&&(o.buffer=n,o.connect(t.audioCtx.destination),o.onended=function(){this.stop(e)},o.start(0),t.sources[e]=o,t.playing[e]=!0)})}},{key:"stop",value:function(e){this.playing[e]=!1,this.sources[e]&&this.sources[e].stop(0),noAudioContext&&fallbackAudio.pause()}},{key:"_load",value:function(e){var t=this,n=this.soundURLs[e];if(this.noAudioContext)return this.fallbackAudio.src=n,new Promise(function(e,t){e(null)});this.audioCtx.resume();var o=this.buffers[e];return new Promise(1==!!o?function(e,t){e(o)}:function(e,o){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer",i.onload=function(){4===i.readyState&&200===i.status?t.audioCtx.decodeAudioData(i.response,function(t){e(t)}):o(new Error(i.statusText))},i.onerror=function(){o(new Error(i.statusText))},i.send(null)})}}])&&A(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function F(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,q(o.key),o)}}function q(e){var t=function(e){if("object"!=O(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==O(t)?t:t+""}var B=new l,I=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);function R(){return I&&I.call(performance)||(new Date).getTime()}var D=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},H=function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sound=new U,this.sound_triggers=[1,2,3,4,5,10,30].map(function(e){return 1e3*e}),this.played_min=!1,this.least_sound_trigger=this.sound_triggers[this.sound_triggers.length-1],this.time_offset=new M,this.timer=new r(this.time_offset),this.last_time=R(),this.elmEta=document.getElementById("eta"),this.elmEtaArea=document.getElementById("eta_area"),this.elmEtaLabel=document.getElementById("eta_label"),this.elmOffset=document.getElementById("offset"),this.elmModeFriend=document.getElementById(h),this.elmModeFriend.addEventListener("click",this.on_change_modeFriend.bind(this)),this.elmModeFrequencyUpdate=document.getElementById(m),this.elmModeFrequencyUpdate.addEventListener("click",this.on_change_modeFrequencyUpdate.bind(this)),this.elmModeShowMS=document.getElementById(y),this.elmModeShowMS.addEventListener("click",this.on_change_modeShowMS.bind(this)),this.elmUseSound=document.getElementById(v),this.elmUseSound.addEventListener("click",this.on_change_useSound.bind(this)),this.elmLabelUseSound=document.getElementById(v+"_label");var n=function(e){t.sound.playSilent(),t.elmLabelUseSound.innerHTML="サウンド再生（制限解除済み）",t.elmLabelUseSound.classList.remove("mdl-color-text--deep-orange-900")};document.addEventListener("click",n),document.addEventListener("touchend",n),this.on_load(),this.update(!0)},t=[{key:"calc_eta",value:function(){this.list=this.timer.listup_next_STT();var e=this.time_offset.get_time(),t=this.list[0]-e;this.notify_sound(t),this.eta=new Date(t)}},{key:"notify_sound",value:function(e){if(this.useSound)if(e>this.least_sound_trigger)this.played_min=!1;else if(!this.played_min){var t=this.sound_triggers.findIndex(function(t){return e<t});this.sound.play(t),this.played_min=t<=0;var n=this.played_min?this.sound_triggers.length-2:t-1;console.log(n),this.least_sound_trigger=this.sound_triggers[n]}}},{key:"update_eta",value:function(){var e=w[y],t=B.getRestTimeTextInUTC(this.eta,e);this.elmEta.innerHTML=t;var n="ST";if(0!=this.time_offset.offset_friend&&(n+="(フレ部屋)"),n+="まで",this.elmEtaLabel.innerHTML=n,this.time_offset.offset_jst){var o="";this.time_offset.offset_jst<0?o+="-"+B.getRestTimeTextInUTC(new Date(-this.time_offset.offset_jst)):o+="+"+B.getRestTimeTextInUTC(new Date(this.time_offset.offset_jst)),o+=" を補正済み",0!=this.time_offset.offset_friend&&(o+=" (更に2秒遅れ中)"),this.elmOffset.innerHTML=o}else this.elmOffset.innerHTML="時刻合わせ中 ..."}},{key:"update_list",value:function(){for(var e in this.list){var t=document.getElementById("stt-item-"+(Number(e)+1)),n=B.getMonthTextInLocalTime(this.list[e]);t.innerHTML=n}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=R(),n=t-this.last_time,o=w[m]||this.eta<6e4?50:1e3;(!e||n>o)&&(this.calc_eta(),this.update_eta(),this.update_list(),n>o&&(this.last_time=t)),e&&D(this.update.bind(this,!0))}},{key:"on_load",value:function(){this.elmModeFriend.checked=w[h],this.elmModeFrequencyUpdate.checked=w[m],this.elmUseSound.checked=w[v],this.on_change_modeFriend(),this.on_change_useSound(),this.on_change_modeFrequencyUpdate()}},{key:"on_change_modeFriend",value:function(){var e="mdl-color--grey-800",t="mdl-color--green-900",n="mdl-color-text--grey-600",o="mdl-color-text--yellow-600",i=this.elmModeFriend.checked;this.elmEtaArea.classList.remove(e),this.elmEtaArea.classList.remove(t),this.elmEtaLabel.classList.remove(n),this.elmEtaLabel.classList.remove(o),this.elmOffset.classList.remove(n),this.elmOffset.classList.remove(o),i?(this.time_offset.set_offset_friend(-2e3),this.elmEtaArea.classList.add(t),this.elmEtaLabel.classList.add(o),this.elmOffset.classList.add(o)):(this.time_offset.set_offset_friend(0),this.elmEtaArea.classList.add(e),this.elmEtaLabel.classList.add(n),this.elmOffset.classList.add(n)),w.save(h,i),this.update(!1)}},{key:"on_change_modeFrequencyUpdate",value:function(){var e=this.elmModeFrequencyUpdate.checked;w.save(m,e),this.update(!0)}},{key:"on_change_modeShowMS",value:function(){var e=this.elmModeShowMS.checked;w.save(y,e),this.update(!0)}},{key:"on_change_useSound",value:function(){if(this.useSound=this.elmUseSound.checked,w.save(v,this.useSound),this.update(!1),this.useSound)return this.sound.loadAll(),void this.sound.play(7)}}],t&&F(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();window.onload=function(){new H}})()})();